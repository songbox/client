language: node_js
node_js:
- '4'

dist: trusty
sudo: required

addons:
  apt:
    sources:
    - google-chrome
    packages:
    - google-chrome-stable

cache:
  directories:
  - $HOME/.npm
  - $HOME/.yarn-cache
  - node_modules

before_install:
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- npm config set spin false
- npm install -g bower yarn codeclimate-test-reporter
- bower --version
- yarn --version

install:
- yarn
- bower install

script:
- COVERAGE=true npm test

after_script:
- codeclimate-test-reporter < coverage/lcov.info

deploy:
  - provider: script
    script: ./node_modules/.bin/ember deploy staging
    on:
      branch: master
  - provider: script
    script: ./node_modules/.bin/ember deploy production
    on:
      branch: production

notifications:
  email: false

